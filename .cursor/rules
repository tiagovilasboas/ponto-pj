# ğŸš€ Ponto PJ - Cursor Rules & Best Practices

Este arquivo contÃ©m todas as boas prÃ¡ticas e padrÃµes arquiteturais implementados neste projeto. Use estas regras como guia para manter a qualidade e consistÃªncia do cÃ³digo.

## ğŸ—ï¸ Arquitetura & PadrÃµes

### Clean Architecture
- **SeparaÃ§Ã£o de responsabilidades**: Cada camada tem uma funÃ§Ã£o especÃ­fica
- **Presentation Layer**: React components, hooks, stores
- **Business Logic Layer**: Services, validation, error handling
- **Data Access Layer**: Repositories, cache, external APIs

### Repository Pattern
- **BaseRepository**: Classe abstrata com funcionalidades comuns
- **CachedRepository**: ExtensÃ£o com sistema de cache inteligente
- **EspecializaÃ§Ã£o**: Cada entidade tem seu prÃ³prio repository
- **ValidaÃ§Ã£o**: Integrada nos mÃ©todos create, update, upsert

### SOLID Principles
- **S** - Single Responsibility: Cada classe tem uma Ãºnica responsabilidade
- **O** - Open/Closed: ExtensÃ­vel sem modificaÃ§Ã£o
- **L** - Liskov Substitution: Repositories intercambiÃ¡veis
- **I** - Interface Segregation: Interfaces especÃ­ficas
- **D** - Dependency Inversion: DependÃªncias injetadas

## ğŸ“ Estrutura de Arquivos

### OrganizaÃ§Ã£o por Responsabilidade
```
src/
â”œâ”€â”€ components/     # UI Components (apenas apresentaÃ§Ã£o)
â”œâ”€â”€ hooks/         # Custom hooks (lÃ³gica de UI)
â”œâ”€â”€ services/      # Business logic (orquestraÃ§Ã£o)
â”œâ”€â”€ repositories/  # Data access (comunicaÃ§Ã£o com APIs)
â”œâ”€â”€ stores/        # State management (apenas estado)
â”œâ”€â”€ lib/           # Utilities (funÃ§Ãµes puras)
â”œâ”€â”€ types/         # TypeScript definitions
â””â”€â”€ test/          # Testes organizados por tipo
```

### ConvenÃ§Ãµes de Nomenclatura
- **Components**: PascalCase (ex: `WorkSessionCard.tsx`)
- **Hooks**: camelCase com prefixo `use` (ex: `useWorkSession.ts`)
- **Services**: camelCase com sufixo `Service` (ex: `workSessionService.ts`)
- **Repositories**: camelCase com sufixo `Repository` (ex: `workSessionRepository.ts`)
- **Stores**: camelCase com sufixo `Store` (ex: `workSessionStore.ts`)
- **Types**: PascalCase (ex: `WorkSession.ts`)
- **Constants**: UPPER_SNAKE_CASE (ex: `API_ENDPOINTS.ts`)

## ğŸ¯ PadrÃµes de CÃ³digo

### TypeScript
- **Tipagem forte**: Sempre use tipos explÃ­citos
- **Interfaces**: Para estruturas de dados
- **Types**: Para unions, intersections, mapped types
- **Generics**: Para componentes e funÃ§Ãµes reutilizÃ¡veis
- **Strict mode**: Sempre habilitado

### React Components
```typescript
// âœ… PadrÃ£o correto
interface ComponentProps {
  data: WorkSession
  onAction: (id: string) => void
  loading?: boolean
}

export function Component({ data, onAction, loading = false }: ComponentProps) {
  // LÃ³gica do componente
  return <div>...</div>
}

// âŒ Evitar
export function Component(props: any) {
  // Sem tipagem
}
```

### Custom Hooks
```typescript
// âœ… PadrÃ£o correto
export function useWorkSession(userId: string) {
  const [data, setData] = useState<WorkSession | null>(null)
  const [loading, setLoading] = useState(false)
  const [error, setError] = useState<string | null>(null)

  // LÃ³gica do hook
  return { data, loading, error, refetch }
}

// âŒ Evitar
export function useWorkSession() {
  // Sem parÃ¢metros tipados
  // Sem retorno tipado
}
```

### Services
```typescript
// âœ… PadrÃ£o correto
export class WorkSessionService {
  async getSessionByDate(date: string): Promise<WorkSession | null> {
    try {
      const userId = await workSessionRepository.getCurrentUserId()
      return await workSessionRepository.findByUserAndDate(userId, date)
    } catch (error) {
      console.error('Erro ao buscar sessÃ£o por data:', error)
      throw error
    }
  }
}

// âŒ Evitar
export class WorkSessionService {
  async getSessionByDate(date: any) {
    // Sem tipagem
    // Sem tratamento de erro
    return await supabase.from('work_sessions').select('*')
  }
}
```

### Repositories
```typescript
// âœ… PadrÃ£o correto
export class WorkSessionRepository extends CachedRepository {
  protected tableName = 'work_sessions'

  async findByUserAndDate(userId: string, date: string): Promise<WorkSession | null> {
    const cacheKey = this.generateCacheKey('session', userId, date)
    
    return this.getCached(cacheKey, async () => {
      const { data, error } = await this.getSupabase()
        .from(this.tableName)
        .select('*')
        .eq('user_id', userId)
        .eq('date', date)
        .single()

      if (error && error.code !== 'PGRST116') {
        this.handleError(error, 'findByUserAndDate')
      }

      return data
    }, { ttl: 2 * 60 * 1000 })
  }
}

// âŒ Evitar
export class WorkSessionRepository {
  async findByUserAndDate(userId: any, date: any) {
    // Sem cache
    // Sem tratamento de erro padronizado
    // Sem tipagem
  }
}
```

## ğŸ”’ ValidaÃ§Ã£o & Tratamento de Erros

### Sistema de ValidaÃ§Ã£o
```typescript
// âœ… Usar validadores especÃ­ficos
const validation = WorkSessionValidator.validateCreateData(data)
if (!validation.isValid) {
  throw new Error(`validation.error: ${validation.errors.join(', ')}`)
}

// âŒ Evitar validaÃ§Ã£o manual
if (!data.user_id) {
  throw new Error('User ID is required')
}
```

### Tratamento de Erros
```typescript
// âœ… Usar ErrorHandler centralizado
import { ErrorHandler } from '@/lib/errorHandler'

try {
  // OperaÃ§Ã£o
} catch (error) {
  const userMessage = ErrorHandler.mapError(error)
  // Mostrar mensagem amigÃ¡vel
}

// âŒ Evitar tratamento genÃ©rico
try {
  // OperaÃ§Ã£o
} catch (error) {
  console.error(error)
  // Sem mapeamento de erro
}
```

## âš¡ Performance & Cache

### Cache Inteligente
```typescript
// âœ… Usar cache com TTL apropriado
return this.getCached(cacheKey, async () => {
  // OperaÃ§Ã£o custosa
}, { ttl: 2 * 60 * 1000 }) // 2 minutos para dados dinÃ¢micos

// âŒ Evitar cache sem TTL
return this.getCached(cacheKey, async () => {
  // OperaÃ§Ã£o
}) // Sem TTL definido
```

### InvalidaÃ§Ã£o de Cache
```typescript
// âœ… Invalidar cache relacionado
this.invalidateCacheByPattern(`session:${userId}`)
this.invalidateCacheByPattern(`sessions:${userId}`)

// âŒ Evitar invalidaÃ§Ã£o desnecessÃ¡ria
this.clearCache() // Limpa todo o cache
```

## ğŸ§ª Testes

### EstratÃ©gia de Testes
- **Unit Tests**: Business logic isolada
- **Integration Tests**: Fluxos principais
- **Component Tests**: Comportamento de UI
- **Repository Tests**: Mock de dependÃªncias

### PadrÃ£o de Testes
```typescript
// âœ… Teste de business logic
describe('WorkSessionBusinessService', () => {
  it('should calculate statistics correctly', () => {
    const sessions = [/* mock data */]
    const stats = WorkSessionBusinessService.calculateStatistics(sessions)
    expect(stats.totalHours).toBe(40)
  })
})

// âœ… Teste de repository
describe('WorkSessionRepository', () => {
  it('should cache results', async () => {
    const result1 = await repository.findByUserAndDate(userId, date)
    const result2 = await repository.findByUserAndDate(userId, date)
    expect(result1).toBe(result2) // Cache hit
  })
})
```

## ğŸŒ InternacionalizaÃ§Ã£o

### Uso de TraduÃ§Ãµes
```typescript
// âœ… Usar hook de traduÃ§Ã£o
import { useTranslation } from '@/i18n/useTranslation'

export function Component() {
  const { t } = useTranslation()
  return <div>{t('app.title')}</div>
}

// âŒ Evitar strings hardcoded
export function Component() {
  return <div>Ponto PJ</div> // Sem traduÃ§Ã£o
}
```

### Estrutura de TraduÃ§Ãµes
```json
{
  "app": {
    "title": "Ponto PJ",
    "subtitle": "Sistema de Ponto EletrÃ´nico"
  },
  "errors": {
    "validation": {
      "required": "Campo obrigatÃ³rio"
    }
  }
}
```

## ğŸ“± PWA & Mobile-First

### Componentes Mobile-Friendly
```typescript
// âœ… Componentes touch-friendly
<button className="min-h-[44px] min-w-[44px]">
  {/* ConteÃºdo */}
</button>

// âŒ Evitar elementos muito pequenos
<button className="h-6 w-6">
  {/* DifÃ­cil de tocar */}
</button>
```

### Responsividade
```css
/* âœ… Mobile-first approach */
.container {
  padding: 1rem;
}

@media (min-width: 768px) {
  .container {
    padding: 2rem;
  }
}

/* âŒ Desktop-first */
.container {
  padding: 2rem;
}

@media (max-width: 767px) {
  .container {
    padding: 1rem;
  }
}
```

## ğŸ” SeguranÃ§a

### ValidaÃ§Ã£o de Entrada
```typescript
// âœ… Validar sempre dados de entrada
const validation = UserValidator.validateCreateData(data)
if (!validation.isValid) {
  throw new Error(`validation.error: ${validation.errors.join(', ')}`)
}

// âŒ Confiar apenas em validaÃ§Ã£o client-side
// Sem validaÃ§Ã£o server-side
```

### AutenticaÃ§Ã£o
```typescript
// âœ… Usar repository para autenticaÃ§Ã£o
const userId = await workSessionRepository.getCurrentUserId()

// âŒ Acessar Supabase diretamente
const { data: { user } } = await supabase.auth.getUser()
```

## ğŸ“Š Estado & Gerenciamento

### Stores (Zustand)
```typescript
// âœ… Store focado apenas em estado
export const useSessionStore = create<SessionState>((set) => ({
  session: null,
  loading: false,
  
  setSession: (session) => set({ session }),
  setLoading: (loading) => set({ loading }),
  
  // Apenas orquestraÃ§Ã£o, sem lÃ³gica de negÃ³cio
  loadSession: async () => {
    set({ loading: true })
    try {
      const session = await workSessionService.getSessionByDate(today)
      set({ session })
    } finally {
      set({ loading: false })
    }
  }
}))

// âŒ Store com lÃ³gica de negÃ³cio
export const useSessionStore = create<SessionState>((set) => ({
  // LÃ³gica de cÃ¡lculo de tempo trabalhado
  // ComunicaÃ§Ã£o direta com Supabase
  // ValidaÃ§Ã£o de dados
}))
```

## ğŸ¨ Design System

### Componentes ReutilizÃ¡veis
```typescript
// âœ… Componente com props bem definidas
interface SquareCTAProps {
  title: string
  subtitle?: string
  icon: React.ReactNode
  onClick: () => void
  variant?: 'primary' | 'secondary' | 'danger'
  disabled?: boolean
}

export function SquareCTA({ 
  title, 
  subtitle, 
  icon, 
  onClick, 
  variant = 'primary',
  disabled = false 
}: SquareCTAProps) {
  // ImplementaÃ§Ã£o
}

// âŒ Componente com props genÃ©ricas
export function SquareCTA(props: any) {
  // Sem tipagem
}
```

### Cores e Gradientes
```css
/* âœ… Usar variÃ¡veis CSS */
:root {
  --primary-gradient: linear-gradient(135deg, #3b82f6, #1d4ed8);
  --success-gradient: linear-gradient(135deg, #10b981, #059669);
  --danger-gradient: linear-gradient(135deg, #ef4444, #dc2626);
}

/* âŒ Cores hardcoded */
.button {
  background: linear-gradient(135deg, #3b82f6, #1d4ed8);
}
```

## ğŸš€ Performance

### Code Splitting
```typescript
// âœ… Lazy loading de componentes
const HistoryPage = lazy(() => import('@/pages/History'))

// âœ… Lazy loading de rotas
const routes = [
  {
    path: '/history',
    element: <Suspense fallback={<Loading />}><HistoryPage /></Suspense>
  }
]
```

### Bundle Optimization
```typescript
// âœ… Manual chunks para otimizaÃ§Ã£o
manualChunks: {
  'react-vendor': ['react', 'react-dom'],
  'mantine': ['@mantine/core', '@mantine/hooks'],
  'supabase': ['@supabase/supabase-js'],
  'i18n': ['i18next', 'react-i18next'],
  'utils': ['dayjs', 'jspdf']
}
```

## ğŸ“ Commits & Git

### Conventional Commits
```bash
# âœ… PadrÃ£o correto
feat: add intelligent caching to repositories
fix: resolve validation error in work session creation
docs: update README with PWA features
refactor: extract business logic to separate service
test: add unit tests for WorkSessionBusinessService

# âŒ Commits genÃ©ricos
update code
fix bug
add feature
```

### Git Hooks (Husky)
O projeto usa Husky para automatizar verificaÃ§Ãµes de qualidade:

#### Pre-commit Hook
- **Lint-staged**: Executa ESLint e Prettier apenas nos arquivos staged
- **Testes**: Roda testes unitÃ¡rios automaticamente
- **FormataÃ§Ã£o**: Aplica formataÃ§Ã£o automÃ¡tica com Prettier

#### Pre-push Hook
- **Type checking**: Verifica tipos TypeScript
- **Testes com coverage**: Executa testes com relatÃ³rio de cobertura
- **ValidaÃ§Ã£o rigorosa**: Garante qualidade antes do push

#### Commit-msg Hook
- **Conventional Commits**: Valida formato das mensagens de commit
- **PadrÃ£o obrigatÃ³rio**: ForÃ§a uso de conventional commits

```bash
# Hooks configurados
.husky/
â”œâ”€â”€ pre-commit      # Lint + Testes
â”œâ”€â”€ pre-push        # Type check + Coverage
â””â”€â”€ commit-msg      # ValidaÃ§Ã£o de mensagem
```

### Branch Naming
```bash
# âœ… PadrÃ£o correto
feature/intelligent-caching
fix/validation-errors
refactor/repository-pattern
docs/update-readme

# âŒ Nomes genÃ©ricos
feature
fix
update
```

## ğŸ¯ Checklist de Qualidade

### Antes de Commitar
- [ ] CÃ³digo segue padrÃµes TypeScript
- [ ] Componentes sÃ£o reutilizÃ¡veis
- [ ] Business logic estÃ¡ em services
- [ ] ValidaÃ§Ã£o implementada
- [ ] Tratamento de erro adequado
- [ ] Cache implementado quando necessÃ¡rio
- [ ] Testes escritos para nova funcionalidade
- [ ] InternacionalizaÃ§Ã£o adicionada
- [ ] Performance nÃ£o degradada
- [ ] Acessibilidade mantida
- [ ] **Husky hooks executados automaticamente** âœ…

### Antes de Fazer PR
- [ ] Todos os testes passando
- [ ] ESLint sem warnings
- [ ] TypeScript sem errors
- [ ] DocumentaÃ§Ã£o atualizada
- [ ] Performance testada
- [ ] Mobile responsivo
- [ ] PWA funcional
- [ ] Cache funcionando
- [ ] ValidaÃ§Ã£o robusta
- [ ] **Pre-push hook executado** âœ…
- [ ] **Coverage de testes adequado** âœ…

## ğŸš¨ Anti-Patterns a Evitar

### âŒ ViolaÃ§Ãµes de SRP
```typescript
// âŒ Classe com mÃºltiplas responsabilidades
class WorkSessionService {
  async startSession() {
    // ComunicaÃ§Ã£o com API
    // CÃ¡lculo de tempo trabalhado
    // ValidaÃ§Ã£o de dados
    // AtualizaÃ§Ã£o de estado
    // Logging
  }
}

// âœ… SeparaÃ§Ã£o de responsabilidades
class WorkSessionService {
  async startSession() {
    const userId = await workSessionRepository.getCurrentUserId()
    const createData = WorkSessionBusinessService.formatCreateData(...)
    return await workSessionRepository.upsert(createData)
  }
}
```

### âŒ ComunicaÃ§Ã£o Direta com APIs
```typescript
// âŒ Acessar Supabase diretamente em componentes
export function Component() {
  const { data } = await supabase.from('work_sessions').select('*')
  return <div>{data}</div>
}

// âœ… Usar repositories
export function Component() {
  const sessions = await workSessionRepository.findByUser(userId)
  return <div>{sessions}</div>
}
```

### âŒ LÃ³gica de NegÃ³cio em Stores
```typescript
// âŒ Store com lÃ³gica de negÃ³cio
const store = create((set) => ({
  startJourney: async () => {
    const workedHours = calculateWorkedHours(start, end)
    // LÃ³gica de negÃ³cio no store
  }
}))

// âœ… Store apenas com estado
const store = create((set) => ({
  startJourney: async () => {
    const session = await workSessionService.startSession()
    set({ session })
  }
}))
```

## ğŸ‰ ConclusÃ£o

Seguindo estas regras, vocÃª manterÃ¡ a qualidade e consistÃªncia do cÃ³digo, garantindo que o projeto continue sendo um boilerplate de referÃªncia para aplicaÃ§Ãµes React escalÃ¡veis.

**Lembre-se**: Qualidade nÃ£o Ã© um ato, Ã© um hÃ¡bito. Aplique estas regras consistentemente em todo o projeto! ğŸš€ 